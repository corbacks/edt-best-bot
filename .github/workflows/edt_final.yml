name: ğŸ“ EDT Bot L2 INFO - Final

on:
  schedule:
    # âš ï¸ UNE SEULE EXÃ‰CUTION PAR SEMAINE : Dimanche Ã  18h
    # Envoie la semaine SUIVANTE (lundi Ã  vendredi)
    
    - cron: "0 17 * * 0"  # Hiver (nov-mars): 18h Paris = 17h UTC
    #- cron: "0 16 * * 0"  # Ã‰tÃ© (mars-oct): 18h Paris = 16h UTC (dÃ©commenter en Ã©tÃ©)
    
  workflow_dispatch:
    inputs:
      force_send:
        description: 'ğŸš€ Forcer l''envoi immÃ©diat'
        required: false
        default: true
        type: boolean
      test_group:
        description: 'ğŸ§ª Groupe Ã  tester (optionnel)'
        required: false
        type: choice
        options:
          - 'Tous les groupes'
          - 'Groupe 1'
          - 'Groupe 2' 
          - 'Groupe 3'
          - 'CM Communs'
      week_mode:
        description: 'ğŸ“† Mode de semaine'
        required: false
        type: choice
        default: 'next'
        options:
          - 'next'        # Semaine suivante (par dÃ©faut)
          - 'current'     # Semaine courante (test)

env:
  PYTHON_VERSION: "3.11"

jobs:
  send-edt:
    name: ğŸ“¤ GÃ©nÃ©ration et Envoi EDT
    runs-on: ubuntu-latest
    timeout-minutes: 20
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
      
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'
      
      - name: ğŸ“¦ Installation dÃ©pendances
        run: |
          echo "ğŸ“¦ Installation..."
          python -m pip install --upgrade pip
          pip install --no-cache-dir requests Pillow
          echo "âœ… DÃ©pendances installÃ©es"
      
      - name: ğŸ• Informations temporelles
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "â° INFORMATIONS"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸŒ UTC   : $(date -u '+%Y-%m-%d %H:%M:%S')"
          echo "ğŸ‡«ğŸ‡· Paris: $(TZ='Europe/Paris' date '+%Y-%m-%d %H:%M:%S')"
          echo "ğŸ“… Jour  : $(TZ='Europe/Paris' date '+%A %d %B %Y')"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      - name: ğŸ“ GÃ©nÃ©ration et envoi EDT
        env:
          WEEK_MODE: ${{ inputs.week_mode || 'next' }}
          # DÃ©commentez et configurez si vous utilisez les secrets GitHub :
          # WEBHOOK_CM: ${{ secrets.WEBHOOK_CM }}
          # WEBHOOK_G1: ${{ secrets.WEBHOOK_G1 }}
          # WEBHOOK_G2: ${{ secrets.WEBHOOK_G2 }}
          # WEBHOOK_G3: ${{ secrets.WEBHOOK_G3 }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸš€ EDT BOT FINAL - ULTRA-LISIBLE"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "âœ¨ AmÃ©liorations:"
          echo "  â€¢ ğŸ¨ Design ultra-lisible"
          echo "  â€¢ ğŸ“ Coins arrondis (radius 10px)"
          echo "  â€¢ ğŸ˜€ Emojis partout (lisibilitÃ© max)"
          echo "  â€¢ ğŸš« DÃ©tection cours annulÃ©s"
          echo "  â€¢ ğŸ“ DÃ©tection examens/partiels"
          echo "  â€¢ ğŸ“Š Statistiques enrichies"
          echo "  â€¢ ğŸ’¬ Message Discord propre"
          echo ""
          echo "ğŸ“¤ Distribution:"
          echo "  â€¢ ğŸ“š CM Communs"
          echo "  â€¢ ğŸ“˜ Groupe 1"
          echo "  â€¢ ğŸ“• Groupe 2"
          echo "  â€¢ ğŸ“— Groupe 3"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          python edt_bot_final.py
      
      - name: ğŸ“Š Upload logs (si Ã©chec)
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: edt-logs-${{ github.run_number }}
          path: |
            *.log
            *.png
          retention-days: 7
          if-no-files-found: ignore
      
      - name: ğŸ“ˆ RÃ©sumÃ©
        if: always()
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ˆ RÃ‰SUMÃ‰"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… ExÃ©cution terminÃ©e"
          echo "ğŸ• $(TZ='Europe/Paris' date '+%Y-%m-%d %H:%M:%S')"
          echo "â±ï¸  Run #${{ github.run_number }}"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“ NOTES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# EXÃ‰CUTION AUTOMATIQUE:
#   - Dimanche 18h : Envoie la semaine SUIVANTE uniquement
#   - Plus d'envoi le mercredi (supprimÃ© comme demandÃ©)
#
# CHANGEMENT HEURE Ã‰TÃ‰/HIVER:
#   Mars     : DÃ©commentez "# Ã‰tÃ©", commentez "Hiver"
#   Octobre  : DÃ©commentez "Hiver", commentez "# Ã‰tÃ©"
#
# SÃ‰CURITÃ‰ WEBHOOKS:
#   1. GitHub : Settings > Secrets > Actions
#   2. CrÃ©ez: WEBHOOK_CM, WEBHOOK_G1, WEBHOOK_G2, WEBHOOK_G3
#   3. DÃ©commentez les lignes env: WEBHOOK_* ci-dessus
#   4. Dans edt_bot_final.py ligne 96, remplacez par:
#      WEBHOOKS = {
#          "CM Communs": os.environ.get("WEBHOOK_CM"),
#          ...
#      }
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
