name: ğŸ“ EDT Bot L2 INFO - Ultra v2.0

on:
  schedule:
    # Dimanche Ã  18:00 Paris (semaine suivante)
    - cron: "0 17 * * 0"  # Hiver (nov-mars): 18h Paris = 17h UTC
    #- cron: "0 16 * * 0"  # Ã‰tÃ© (mars-oct): 18h Paris = 16h UTC (dÃ©commenter en Ã©tÃ©)
    
    # Mercredi Ã  06:00 Paris (semaine courante)
    - cron: "0 5 * * 3"   # Hiver: 6h Paris = 5h UTC
    #- cron: "0 4 * * 3"   # Ã‰tÃ©: 6h Paris = 4h UTC (dÃ©commenter en Ã©tÃ©)
    
  workflow_dispatch:
    inputs:
      force_send:
        description: 'ğŸš€ Forcer l''envoi immÃ©diat'
        required: false
        default: true
        type: boolean
      test_group:
        description: 'ğŸ§ª Groupe Ã  tester (optionnel)'
        required: false
        type: choice
        options:
          - 'Tous les groupes'
          - 'Groupe 1'
          - 'Groupe 2' 
          - 'Groupe 3'
          - 'CM Communs'
      week_mode:
        description: 'ğŸ“† Mode de semaine'
        required: false
        type: choice
        default: 'auto'
        options:
          - 'auto'        # Automatique (dimanche=next, autres=current)
          - 'current'     # Force semaine courante
          - 'next'        # Force semaine suivante

env:
  PYTHON_VERSION: "3.11"
  # Les webhooks peuvent Ãªtre configurÃ©s via secrets GitHub (recommandÃ©)
  # WEBHOOK_CM: ${{ secrets.WEBHOOK_CM }}
  # WEBHOOK_G1: ${{ secrets.WEBHOOK_G1 }}
  # WEBHOOK_G2: ${{ secrets.WEBHOOK_G2 }}
  # WEBHOOK_G3: ${{ secrets.WEBHOOK_G3 }}

jobs:
  send-edt:
    name: ğŸ“¤ GÃ©nÃ©ration et Envoi EDT
    runs-on: ubuntu-latest
    timeout-minutes: 25
    
    steps:
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ğŸ“¥ PRÃ‰PARATION
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      - name: ğŸ“¥ Checkout du code
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      
      - name: ğŸ Installation Python ${{ env.PYTHON_VERSION }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}
          cache: 'pip'
      
      - name: ğŸ“¦ Installation des dÃ©pendances
        run: |
          echo "ğŸ“¦ Mise Ã  jour de pip..."
          python -m pip install --upgrade pip
          
          echo "ğŸ“¦ Installation des packages requis..."
          pip install --no-cache-dir requests Pillow
          
          echo "âœ… Packages installÃ©s:"
          pip list | grep -E "(requests|Pillow)"
      
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ğŸ• INFORMATIONS TEMPORELLES
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      - name: ğŸ• Affichage des informations temporelles
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "â° INFORMATIONS TEMPORELLES"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸŒ UTC      : $(date -u '+%Y-%m-%d %H:%M:%S %Z')"
          echo "ğŸ‡«ğŸ‡· Paris   : $(TZ='Europe/Paris' date '+%Y-%m-%d %H:%M:%S %Z (UTC%z)')"
          echo "ğŸ“… Jour     : $(TZ='Europe/Paris' date '+%A %d %B %Y')"
          echo "ğŸ“Š Semaine  : $(TZ='Europe/Paris' date '+Semaine %V de %Y')"
          echo "ğŸ”¢ Jour num : $(date +%u) (1=Lundi, 7=Dimanche)"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ğŸ”§ INFORMATIONS DE DEBUG (exÃ©cution manuelle)
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      - name: ğŸ”§ Debug - ParamÃ¨tres d'exÃ©cution manuelle
        if: github.event_name == 'workflow_dispatch'
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ”§ EXÃ‰CUTION MANUELLE - PARAMÃˆTRES"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âš™ï¸  Force send  : ${{ inputs.force_send }}"
          echo "ğŸ§ª Test group  : ${{ inputs.test_group }}"
          echo "ğŸ“† Week mode   : ${{ inputs.week_mode }}"
          echo "ğŸ‘¤ DÃ©clenchÃ© par: ${{ github.actor }}"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ğŸ¨ GÃ‰NÃ‰RATION ET ENVOI DES EDT
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      - name: ğŸ“ GÃ©nÃ©ration et envoi des EDT
        env:
          WEEK_MODE: ${{ inputs.week_mode || 'auto' }}
          TEST_GROUP: ${{ inputs.test_group }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸš€ LANCEMENT EDT BOT ULTRA v2.0"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "âœ¨ FonctionnalitÃ©s activÃ©es:"
          echo "  â€¢ ğŸ¨ GÃ©nÃ©ration d'images style ADE Calendar"
          echo "  â€¢ ğŸŒˆ Codes couleur par type de cours"
          echo "  â€¢ ğŸ“Š Statistiques avancÃ©es"
          echo "  â€¢ â° Indicateur temps rÃ©el"
          echo "  â€¢ ğŸ¯ Optimisations visuelles"
          echo ""
          echo "ğŸ“¤ Distribution des EDT:"
          echo "  â€¢ ğŸ“š CM Communs â†’ Salon L2 Ã‰tudiant"
          echo "  â€¢ ğŸ“˜ Groupe 1   â†’ Salon Groupe 1"
          echo "  â€¢ ğŸ“• Groupe 2   â†’ Salon Groupe 2"
          echo "  â€¢ ğŸ“— Groupe 3   â†’ Salon Groupe 3"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          python edt_bot_ultimate.py
      
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ğŸ“Š UPLOAD DES ARTIFACTS EN CAS D'ERREUR
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      - name: ğŸ“Š Sauvegarde des logs (en cas d'Ã©chec)
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: edt-logs-${{ github.run_number }}
          path: |
            *.log
            *.png
            *.txt
          retention-days: 7
          if-no-files-found: ignore
      
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ğŸ“ˆ RÃ‰SUMÃ‰ ET STATISTIQUES
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      - name: ğŸ“ˆ RÃ©sumÃ© de l'exÃ©cution
        if: always()
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ˆ RÃ‰SUMÃ‰ DE L'EXÃ‰CUTION"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… Job terminÃ©"
          echo "ğŸ• Date: $(TZ='Europe/Paris' date '+%Y-%m-%d %H:%M:%S')"
          echo "â±ï¸  Run: #${{ github.run_number }}"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
      
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      # ğŸ”” NOTIFICATION DISCORD (optionnel - en cas de problÃ¨me)
      # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      - name: ğŸ”” Notification d'Ã©chec (optionnel)
        if: failure() && github.event_name != 'workflow_dispatch'
        run: |
          echo "âš ï¸ Le workflow a Ã©chouÃ©"
          echo "Consultez les logs pour plus de dÃ©tails"
          # Vous pouvez ajouter ici un webhook Discord pour les notifications d'erreur
          # curl -X POST "$WEBHOOK_URL" -H "Content-Type: application/json" \
          #   -d '{"content":"âŒ EDT Bot: Ã‰chec de l'\''exÃ©cution automatique"}'

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“ NOTES D'UTILISATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# DÃ‰CLENCHEMENT AUTOMATIQUE:
#   - Dimanche 18h : Envoie la semaine SUIVANTE (anticipation)
#   - Mercredi 6h  : Envoie la semaine COURANTE (rappel)
#
# DÃ‰CLENCHEMENT MANUEL:
#   - Allez dans Actions > EDT Bot > Run workflow
#   - Choisissez les paramÃ¨tres souhaitÃ©s
#   - Cliquez sur "Run workflow"
#
# CHANGEMENT HEURE Ã‰TÃ‰/HIVER:
#   - DÃ©commentez les crons avec "# Ã‰tÃ©" en mars
#   - Recommentez les crons avec "# Hiver" en mars
#   - Inversez en octobre
#
# SÃ‰CURITÃ‰ (RECOMMANDÃ‰):
#   - Stockez les webhooks comme secrets GitHub:
#     Settings > Secrets > Actions > New repository secret
#   - Nommez-les: WEBHOOK_CM, WEBHOOK_G1, WEBHOOK_G2, WEBHOOK_G3
#   - DÃ©commentez les lignes env: WEBHOOK_* ci-dessus
#   - Retirez les URLs hardcodÃ©es du script Python
#
# PERSONNALISATION:
#   - Modifiez les couleurs dans edt_bot_ultimate.py (section COLORS)
#   - Ajustez les dimensions d'image (WIDTH/HEIGHT)
#   - Changez les horaires affichÃ©s (START_HOUR/END_HOUR)
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
